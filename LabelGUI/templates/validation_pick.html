<!DOCTYPE html>
<html>
<head>
  <title>Select Entry to Label</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .status-dot { display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:6px; }
    .ok { background:#10b981; }      /* green */
    .no { background:#ef4444; }      /* red */
    .muted { color:#666; font-size: 0.9em; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 16px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align:left; }
    th { background:#f8f8f8; }
    .nowrap { white-space: nowrap; }
    .truncate { max-width: 420px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  </style>
</head>
<body>
<div class="container">
  <h1>Select a Video to Label</h1>

  {% if entries and entries|length > 0 %}
    <!-- Status overview table (green/red + counts) -->
    <table>
      <tr>
        <th>Status</th>
        <th>Person</th>
        <th class="nowrap">Prefix</th>
        <th class="nowrap">Sessions</th>
        <th class="nowrap">Total events</th>
        <th>Link</th>
      </tr>
      {% for e in entries %}
        <tr>
          <td>
            {% if e.labeled %}
              <span class="status-dot ok"></span>
              <strong>Labeled</strong>
            {% else %}
              <span class="status-dot no"></span>
              <strong>Not labeled</strong>
            {% endif %}
          </td>
          <td>{{ e.person }}</td>
          <td class="nowrap">{{ e.prefix }}</td>
          <td class="nowrap">{{ e.sessions }}</td>
          <td class="nowrap">{{ e.total_events }}</td>
          <td class="truncate" title="{{ e.link }}">{{ e.link }}</td>
        </tr>
      {% endfor %}
    </table>

    <!-- Your existing form, with status hints inside each option -->
    <form method="POST" action="/start_from_excel">
      <label for="entry_id">Entry:</label>
      <select id="entry_id" name="entry_id" required>
        {% for e in entries %}
          <option value="{{ e.id }}">
            {{ e.person }} — {{ e.link }}
            {% if e.labeled %} [✔ {{ e.sessions }} sess / {{ e.total_events }} ev]{% else %} [✖ not labeled]{% endif %}
          </option>
        {% endfor %}
      </select>

      <br><br>
      <label for="scenario_base">Session Type:</label>
      <select id="scenario_base" name="scenario_base" required>
        <option value="Simulation">Simulation</option>
        <option value="Real flight">Real flight</option>
      </select>

      <br><br>
      <input type="checkbox" id="delete_original" name="delete_original">
      <label for="delete_original">Delete original downloaded video after processing</label>

      <br><br>
      <button type="submit">Start Labeling</button>
      <p class="muted">Tip: Green rows already have at least one labeled session.</p>
    </form>
  {% else %}
    <p>No entries loaded. Please <a href="/import_excel">import an Excel file</a> first.</p>
  {% endif %}

  <br>
  <a href="/"><button type="button">Back to Home</button></a>
</div>
</body>
</html>
